const e=function(){let e=void 0;const t=require("path"),r=require("fs");return e=function(e){e("echo",["str","allow_html"],(function(e,t,r,n){"string"==typeof t.str&&(t.str=t.str.replace(/&#44;/gs,",").replace(/&#40;/gs,"(").replace(/&#41;/gs,")"));let s=n.setObject(t.str,e,!0),l=n.setObject(t.allow_html,e);return s=["string","number","boolean"].includes(typeof s)?s.toString():"",l?s:n.escapeHtml(s)})),e("echo_html",["str"],(function(e,t,r,n){"string"==typeof t.str&&(t.str=t.str.replace(/&#44;/gs,",").replace(/&#40;/gs,"(").replace(/&#41;/gs,")"));let s=n.setObject(t.str,e,!0);return s=["string","number","boolean"].includes(typeof s)?s.toString():"",s})),e("if",["logic"],{hasContent:!0},(function(e,t,r,n){return!(!t.logic||!r)&&!!function t(r){r.startsWith("(")&&r.endsWith(")")&&(r=r.substring(1,r.length-1)),r=r.replace(/^\((.*?)\)$/,"$1").split(/([&|])/g);let s=!1,l=!1;function i(r){let s,l=!1,i=1e3;for(;r.startsWith("!")&&i-- >0;)l=!l,r=r.replace("!","").trim();return s=r.startsWith("(")&&r.endsWith(")")?t(r):n.checkIf(r,e),l?!s:s}for(let e=0;e<r.length;e++)if(r[e]=r[e].trim(),r[e]&&""!==r[e])if("&"===r[e]||"|"===r[e])l=r[e];else if(l)if(s&&"&"===l)s=i(r[e]);else{if(s||"|"!==l)break;s=i(r[e])}else s=i(r[e]);return s}(t.logic.toString())&&n.runMainFunctions("<?"+r+"?>",e)})),e("each",["obj","as","of","from"],{hasContent:!0},(function(e,t,r,n){if(!t.obj||!r)return;r=r.toString();let s=t.obj.split("&"),l="";for(let i=0;i<s.length;i++){t.from&&(e.$temp[t.from.replace("$","")]=s[i].split(".").pop());let a=n.setObject(s[i],e);n.forEach(a,(function(s,i){t.as&&(e.$temp[t.as.replace("$","")]=s),t.of&&(e.$temp[t.of.replace("$","")]=i),l+=n.runMainFunctions("<? "+r+" ?>",e)}))}return t.as&&delete e.$temp[t.as.replace("$","")],t.of&&delete e.$temp[t.of.replace("$","")],t.from&&delete e.$temp[t.from.replace("$","")],l})),e("import",["path"],(function(e,n,s,l){if(!n.path)return;let i=n.path.toString().trim();if(i.endsWith(p)||(i+=p),i=i.startsWith(c)?t.resolve(i):t.join(c,i),!i.startsWith(c))return;let a=l.getFileCache(i);if(!a&&r.existsSync(i)){if(a=r.readFileSync(i).toString(),!a||""===a.trim())return void l.setFileCache(i,!1,e);l.setFileCache(i,a,e)}return a&&""!==a.trim()?(a.startsWith("\n")||(a="\n\r"+a),a.endsWith("\n")||(a+="\n\r"),a=l.autoCloseTags(a),l.runMainFunctions(a,e)):void 0})),e("setUserVar",["name","value"],(function(e,t,r,n){t.name&&t.value&&(e.$userVars[n.setObject(t.name,e,!0)]=n.setObject(t.value,e,!0))})),e("typeof",["var","literal"],{returnResult:!0,noEcho:!0},(function(e,t,r,n){let s,l=n.setObject(t.var,e);if(t.literal)return typeof l;if("string"==typeof l)try{l=JSON.parse(l)}catch(e){}return s="string"==typeof l?"[object Object]"===l?"object":"[array Array]"===l?"array":"[function Function]"===l?"function":l.match(/^[0-9]+(\.[0-9]+|)$/)?"number":"true"===l||"false"===l?"boolean":"undefined"===l?"undefined":"null"===l?"null":"string":Array.isArray(l)?"array":typeof l,"'"+s+"'"})),e("log",(function(e,t,r,n){if(!t)return;let s=[];n.forEach(t,t=>{let r=n.setObject(t,e);s.push([t,r])}),console.log(...s)}))},e}(),t=require("fs"),r=require("path"),n=require("crypto"),s=require("obj-memory-cache"),l=require("safe-regex"),i=require("math-expression-evaluator"),a=s.newCache();let o={},c="",p="";const u=["meta","link","img","br","hr","input"],g={},f={runMainFunctions:_,escapeHtml:T,unescapeHtml:M,escapeRegex:q,escapeInvalidTags:O,stripInvalidTags:R,normalizeJson:E,forEach:B,autoCloseTags:k,getFileCache:$,setFileCache:y,checkIf:function(e,t){function r(e){return e[0]=A(e[0],t),e[1]=A(e[1],t),"string"==typeof e[0]?e[0].match(/^-?[0-9]+(\.[0-9]+|)$/)?e[0]=Number(e[0]):"true"===e[0]?e[0]=!0:"false"===e[0]&&(e[0]=!1):Array.isArray(e[0])?e[0]=e[0].length>0:"object"==typeof e[0]&&(e[0]=Object.keys(e[0]).length>0),"string"==typeof e[1]?e[1].match(/^-?[0-9]+(\.[0-9]+|)$/)?e[1]=Number(e[1]):"true"===e[1]?e[1]=!0:"false"===e[1]&&(e[1]=!1):Array.isArray(e[1])?e[1]=e[1].length>0:"object"==typeof e[1]&&(e[1]=Object.keys(e[1]).length>0),e}if(e.includes("==="))return(e=r(e.split("===",2)))[0]===e[1];if(e.includes("!=="))return(e=r(e.split("!==",2)))[0]!==e[1];if(e.includes("=="))return(e=r(e.split("==",2)))[0]===e[1];if(e.includes("!="))return(e=r(e.split("!=",2)))[0]!==e[1];if(e.includes(">="))return(e=r(e.split(">=",2)))[0]>=e[1];if(e.includes("<="))return(e=r(e.split("<=",2)))[0]<=e[1];if(e.includes("="))return(e=r(e.split("=",2)))[0]===e[1];if(e.includes(">"))return(e=r(e.split(">",2)))[0]>e[1];if(e.includes("<"))return(e=r(e.split("<",2)))[0]<e[1];if("string"==typeof(e=A(e,t)))e.match(/^-?[0-9]+(\.[0-9]+|)$/)?e=Number(e):"true"===e?e=!0:"false"===e&&(e=!1);else{if(Array.isArray(e))return e.length>0;if("object"==typeof e)return Object.keys(e).length>0}return e||0===e},getRandomToken:h,setObject:A,getObj:H};function m(e){if("string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e)return;let t,r,n,s={hasContent:!1,returnResult:!1};if("function"==typeof arguments[3]?(t=arguments[1],r=arguments[2],n=arguments[3]):"function"==typeof arguments[2]?("object"!=typeof arguments[1]||Array.isArray(arguments[1])?t=arguments[1]:r=arguments[1],n=arguments[2]):"function"==typeof arguments[1]&&(n=arguments[1]),r=r?{...s,...r}:s,t?Array.isArray(t)||(t=[t]):t=[],e=e.toString().trim(),"function"==typeof t)if(n){let e=n;n=t,t=e}else n=t;return Array.isArray(t)||(t=[t]),t=t.map(e=>e.toString().trim()),g[e]={attrs:t,callback:n,opts:r},!0}function h(e){return n.randomBytes(e).toString("hex")}function $(e){return a.get("template_file:"+e)}function y(e,t,r){t&&(t=t.toString()),a.set("template_file:"+e,t,{expire:r.cache||o.cache})}function b(e,n,s){p=e.substr(e.lastIndexOf(".")),c=r.join(e,"..");let l=$(e);if(l){if(o&&"function"==typeof o.onBeforeRender){let e=o.onBeforeRender(Buffer.from(l,"utf8"));e&&"string"==typeof e&&(l=e)}else if(n&&"function"==typeof n.onBeforeRender){let e=n.onBeforeRender(Buffer.from(l,"utf8"));e&&"string"==typeof e&&(l=e)}let e=d(l,n);if(o&&"function"==typeof o.onAfterRender){let t=o.onAfterRender(Buffer.from(e,"utf8"));t&&"string"==typeof t&&(e=t)}else if(n&&"function"==typeof n.onAfterRender){let t=n.onAfterRender(Buffer.from(e,"utf8"));t&&"string"==typeof t&&(e=t)}return s(null,e.toString())}t.readFile(e,(function(t,r){if(t)return s(t);if(y(e,r,n),o&&"function"==typeof o.onBeforeRender){let e=o.onBeforeRender(r);e&&"string"==typeof e&&(r=e)}else if(n&&"function"==typeof n.onBeforeRender){let e=n.onBeforeRender(r);e&&"string"==typeof e&&(r=e)}let l=d(r,n);if(o&&"function"==typeof o.onAfterRender){let e=o.onAfterRender(Buffer.from(l,"utf8"));e&&"string"==typeof e&&(l=e)}else if(n&&"function"==typeof n.onAfterRender){let e=n.onAfterRender(Buffer.from(l,"utf8"));e&&"string"==typeof e&&(l=e)}return s(null,l.toString())}))}function d(e,n={}){let s=!1;if(o.logSpeed&&(s=(new Date).getTime()),e=e.toString(),o&&o.raw)return e;if(e.startsWith("\n")||(e="\n\r"+e),e.endsWith("\n")||(e+="\n\r"),e=k(e),n){let e={};B(n,(t,r)=>{"function"!=typeof t&&(["string","number","boolean","object"].includes(typeof t)||Array.isArray(t))&&(e[r]=t)}),n=e}else n={};n.opts&&"object"==typeof n.opts||(n.opts={}),n.$&&"object"==typeof n.$||(n.$={}),n.$functions&&"object"==typeof n.$functions||(n.$functions={}),n.$temp&&"object"==typeof n.$temp||(n.$temp={}),n.$userVars&&"object"==typeof n.$userVars||(n.$userVars={}),n.$returns&&"object"==typeof n.$returns||(n.$returns={}),n.$strings&&"object"==typeof n.$strings||(n.$strings={}),n.extractTags?Array.isArray(n.extractTags)||(n.extractTags=[n.extractTags]):n.extractTags=[],o.extractTags&&(Array.isArray(o.extractTags)||(o.extractTags=[o.extractTags]),n.extractTags=[...o.extractTags,...n.extractTags]),e=(e=function(e,n){if(n.template||o.template){let s=n.template||o.template;if(s.endsWith(p)||(s+=p),s=s.startsWith(c)?r.resolve(s):r.join(c,s),!s.startsWith(c))return e;let l=$(s);if(!l&&t.existsSync(s)){if(l=t.readFileSync(s).toString(),!l||""===l.trim())return y(s,!1,n),e;y(s,l,n)}if(!l||""===l.trim())return e;l.startsWith("\n")||(l="\n\r"+l),l.endsWith("\n")||(l+="\n\r"),l=k(l),e=l.replace(/(<\?(js|php|)\s*?body\(\);?\s*?\?>|{{{?#?\s*?body\s*?}}}?)/gs,e)}return e}(e,n)).split(/({{{?#no[_-]?html}}}?.*?{{{?\/no[_-]?html}}}?)/gis);for(let t=0;t<e.length;t++)e[t].match(/({{{?#no[_-]?html}}}?.*?{{{?\/no[_-]?html}}}?)/gis)?e[t]=T(e[t].replace(/{{{?#no[_-]?html}}}?(.*?){{{?\/no[_-]?html}}}?/gis,"$1")):e[t]=j(e[t],n);e=(e=function(e,t){if(t.extractTags&&t.extractTags.length&&Array.isArray(t.extractTags)){let r=t.extractTags.map(e=>q(e.toString())).join("|");t.extractTags.includes("style")&&!t.extractTags.includes("link")&&(r+="|link");let n=new RegExp("<("+r+")(\\s+?.*?|)>(.*?)<\\/(?:"+r+")(?:\\s+?.*?|)>","gs");if(l(n)){const r={};e=e.replace(n,(function(e,n,s,l){let i="<"+(n=n.trim())+" "+s.trim()+">"+l+"</"+n+">";return"link"===n&&t.extractTags.includes("style")&&s.match(/\s+?rel="stylesheet"/gs)?(r.style||(r.style=[]),r.style.push(i),""):"link"!==n||t.extractTags.includes("link")&&!s.match(/\s+?rel="stylesheet"/gs)?(r[n]||(r[n]=[]),r[n].push(i),""):i})),n=new RegExp("{{-("+n+")}}","gs"),l(n)&&(e=e.replace(n,(function(e,t){return r[t]?r[t].join("\n"):""})))}}return e}(e=function(e,t){return e.replace(/({{{?)(.*?)(}}}?)/gs,(function(e,r,n,s){if(!n||""===n.trim())return"";const l="{{{"!==r||"}}}"!==s;if((n=n.toString().trim()).startsWith("-"))return n=n.substring(1).trim(),t.extractTags.push(n),"{{-"+n+"}}";if(n.includes("=")){if(!(n=n.split("=",2))[1]||""===n[1].trim())return"";n[1]=n[1].trim(),n[1].startsWith('"')&&n[1].endsWith('"')&&(n[1]=n[1].substring(1,n[1].length-1)),n[0]&&""!==n[0].trim()?n[0]=n[0].trim():n[0]=n[1],n[0].includes(".")&&(n[0]=n[0].split(".",1)[0]),n[0].includes("[")&&(n[0]=n[0].split("[",1)[0]);let e=A(n[1],t,"regve");return l&&(e=T(e)),n[0]+'="'+e+'"'}{n.startsWith('"')&&n.endsWith('"')&&(n=n.substring(1,n[1].length-1));let e=A(n,t,"regve");return l&&(e=T(e)),e}}))}(e=(e=(e=_(e=e.join(""),n)).replace(/<\?(js|php|).*?\?>/gs,"")).replace(/<&[\w_\-]*%.*?%&>/gs,""),n),n)).split(/({{{?#no[_-]?html}}}?.*?{{{?\/no[_-]?html}}}?)/gis);for(let t=0;t<e.length;t++)e[t].match(/({{{?#no[_-]?html}}}?.*?{{{?\/no[_-]?html}}}?)/gis)?e[t]=T(e[t].replace(/{{{?#no[_-]?html}}}?(.*?){{{?\/no[_-]?html}}}?/gis,"$1")):e[t]=j(e[t],n);if(e=e.join(""),!o.noMarkdown&&!n.noMarkdown){e=e.split(/({{{?#no[_-]?markdown}}}?.*?{{{?\/no[_-]?markdown}}}?)/gis);for(let t=0;t<e.length;t++)e[t].match(/({{{?#no[_-]?markdown}}}?.*?{{{?\/no[_-]?markdown}}}?)/gis)?e[t]=e[t].replace(/{{{?#no[_-]?markdown}}}?(.*?){{{?\/no[_-]?markdown}}}?/gis,"$1"):e[t]=w(e[t],n);e=e.join("")}if(e=(e=(e=(e=e.replace(/<\?(js|php|).*?\?>/gs,"").replace(/\?>/gs,"")).replace(/<&[\w_\-]*%.*?%&>/gs,"")).replace(/{{{?.*?}}}?/gs,"")).toString().trim(),o.logSpeed&&s){let e=(new Date).getTime()-s;console.log("[34mAspive rendered in[32m",e,"[34mmilliseconds[0m")}return e}function j(e,t){return e=e.replace(/\$\{(.*?)\}/gm,(function(e,r){return r=r.trim(),t.$userVars[r]?t.$userVars[r]:""})),t.noHtmlRules&&t.noHtmlRules.allowUserVars&&(e=e.replace(/\$&lbrace;(.*?)&rbrace;/gm,(function(e,r){return r=r.trim(),t.$userVars[r]?t.$userVars[r]:""}))),e}function _(e,t){return e.replace(/<\?(js|php|)(.*?)\?>/gs,(function(e,r,n){let s="";function i(e){return["string","number","boolean"].includes(typeof e)?e.toString():""}n=n.replace(/\/\*.*?\*\//gs,"").replace(/\/\/.*/gm,"");const a={...f};function o(e){s+=e.toString()}a.result=function(e){s+=i(e)},a.setResult=i,n=(n=n.replace(/\\'/gs,"&#39;").replace(/\\"/gs,"&#34;").replace(/(['"])(.*?)\1/gs,(function(e,r,n){let s=h(16)+h(16);return t.$strings[s]=r+n.replace(/&#39;/gs,"\\'").replace(/&#34;/gs,'\\"')+r,"<&string%"+s+"%&>"}))).replace(/[\n\r\t\s]/gs," ").replace(/\s\s/gs," ").replace(/else\s*?{/gs,"else if(true){");const c={};let p=1e3;for(;n.match(/\{([^{}]*)\}/gs)&&p-- >0;)n=n.replace(/\{([^{}]*)\}/gs,(function(e,t){let r=h(16)+h(16);return c[r]=t,"<&%"+r+"%&>"}));n=(n=(n=n.replace(/<&%(.*?)%&>/gs,(function(e,t){return"{<&%"+t+"%&>}"}))).replace(/function\s*?([\w_\-.\[\]]+)\((.*?)\)\s*?\{<&%(.*?)%&>\}/gs,(function(e,r,n,s){s=c[s]?c[s]:"",n=n.split(",").map(e=>e.trim()).filter(e=>e&&""!==e);let l=1e3;for(;s.match(/<&%(.*?)%&>/gs)&&l-- >0;)s=s.replace(/<&%(.*?)%&>/gs,(function(e,t){return c[t]?"{"+c[t]+"}":"{}"}));return t.$functions[r]=function(e,t){const r=s,l=n,i={};for(let r=0;r<t.length;r++){let n=l[r]||r;i[n]=A(t[r],e)}let a=_("<? "+r.replace(/\$([\w_\-.\[\]]+)/gs,(function(t,r){return r="$"+r.toString().trim(),i[r]?A(i[r],e):t}))+" ?>",e),o=!1;return a=a.replace(/<&return%(.*?)%&>.*?/gs,(function(t,r){return o||(o=e.$returns[r]),""})),{result:a,return:o}},""}))).split(/(.*?[;}])/gs).filter(e=>e&&""!==e.trim()).map(e=>{e=e.replace(/\{<&%(.*?)%&>\}/gs,(function(e,t){return t&&""!==t.trim()&&c[t]?"{"+c[t]+"}":"{}"}));let t=0;for(;e.match(/<&%(.*?)%&>/gs)&&t-- >0;)e=e.replace(/<&%(.*?)%&>/gs,(function(e,t){return t&&""!==t.trim()&&c[t]?"{"+c[t]+"}":"{}"}));return e});const u={runElse:!1};for(let e=0;e<n.length;e++){if(n[e]=n[e].trim(),n[e].startsWith("return ")){let r=h(16)+h(16);t.$returns[r]=n[e].replace("return ","").replace(/;$/,""),s+="<&return%"+r+"%&>";break}if(n[e].startsWith("echo_html ")?n[e]="echo("+n[e].replace(/^echo_html\s*/,"").replace(/;$/,"").replace(/,/gs,"&#44;").replace(/\(/gs,"&#40;").replace(/\)/gs,"&#41;")+", true);":n[e].startsWith("echo ")&&(n[e]="echo("+n[e].replace(/^echo\s*/,"").replace(/;$/,"").replace(/,/gs,"&#44;").replace(/\(/gs,"&#40;").replace(/\)/gs,"&#41;")+");"),n[e].match(/^\$[\w_\-.\[\]]+\s*?[+\-*\/.]?=\s*?.*?/))n[e].replace(/^\$([\w_\-.\[\]]+)\s*?([+\-*\/.]|)=\s*?(.*?)[;}]/,(function(e,r,n,s){if(s=A(s,t,!1,{funcOpts:u,funcMethods:a},o),!n||""===n.trim())return void(t.$[r]=s);let i=t.$[r];if("string"==typeof i&&i.match(/^-?[0-9]+(\.[0-9]+|)$/)&&Number(i)&&(i=Number(i)),Array.isArray(i))"+"===n||"."===n||"*"===n?t.$[r].push(s):"-"!==n&&"/"!==n||i.indexOf(s)&&t.$[r].splice(i.indexOf(s),1);else if("object"!=typeof i||"object"!=typeof s)if("object"!=typeof i||"string"!=typeof s&&!Array.isArray(s)||"-"!==n&&"/"!==n){if(["string","boolean","number"].includes(typeof s)&&["string","boolean","number"].includes(typeof i))if("+"===n||"."===n)t.$[r]=i+s;else if("-"===n&&"number"==typeof s&&"number"==typeof i)t.$[r]=i-s;else if("-"===n)t.$[r]=i.replace(s,"");else if("*"===n&&"number"==typeof s&&"string"==typeof i)t.$[r]=i.repeat(s);else if("*"===n&&"number"==typeof s&&"number"==typeof i)t.$[r]=i*s;else if("*"===n)t.$[r]=i+s;else if("/"===n&&"number"==typeof s&&"number"==typeof i)t.$[r]=i/s;else if("/"===n){let e=new RegExp(q(s),"g");l(e)&&(t.$[r]=i.replace(e,""))}}else{let e=Object.keys(i),t=Object.values(i);Array.isArray(s)||(s=[s]);for(let r=0;r<s.length;r++)delete i[e[t.indexOf(s[r])]]}else if("+"===n||"."===n||"*"===n){let e=Object.keys(s);for(let t=0;t<e.length;t++)i[e[t]]=s[e[t]];t.$[r]=i}else if("-"===n||"/"===n){let e=Object.keys(i),t=Object.values(i),r=Object.values(s);for(let n=0;n<r.length;n++)delete i[e[t.indexOf(r[n])]]}}));else if(n[e].match(/^(else |)[\w_\-.\[\]]+\(.*?\)(\{.*?\}|)/)){let r=S(n[e],t,u.runElse,a);u.runElse=r.runElse,r.result&&(s+=r.result.toString())}}return s}))}function S(e,t,r=!1,n){let s="",l=!1;return e.replace(/^(else |)([\w_\-.\[\]]+)\((.*?)\)(?:\{(.*?)\}|)/,(function(e,i,a,o,c){if(r||!i||""===i.trim())if(r=!1,o=(o=o?o.toString():"").split(",").map(e=>(e=e.replace(/<&string%(.*?)%&>/gs,(function(e,r){return t.$strings[r]?t.$strings[r]:""}))).trim()).filter(e=>e&&""!==e),t.$functions[a]){let e=t.$functions[a](t,o);e.result&&(s+=e.result.toString()),e.return&&(l=e.return)}else if(g[a]){let e={};if(g[a].attrs){let t=g[a].attrs;for(let r=0;r<t.length;r++)e[t[r]]=o.shift()}for(let t=0;t<o.length;t++)e[t]||(e[t]=o[t]);let i=void 0;g[a].opts.hasContent&&c&&""!==c.toString().trim()?i=g[a].callback(t,e,c.toString(),n):g[a]&&(i=g[a].callback(t,e,null,n)),!1===i?(r=!0,l=!1):i&&(i=i.replace(/<&return%(.*?)%&>.*?/gs,(function(e,r){return l||(l=t.$returns[r]),""})),s+=i.toString()),g[a].opts.returnResult&&(l=i),g[a].opts.noEcho&&(s="")}})),{result:s,return:l,runElse:r}}function A(e,t,r=!1,n=!1,s=!1){if(!e||!["string","number","boolean"].includes(typeof e))return;(e=e.toString().trim()).endsWith(";")&&(e=e.substring(0,e.length-1)),e.match(/<&string%.*?%&>/)&&(e=e.replace(/<&string%(.*?)%&>/gs,(function(e,r){return t.$strings[r]?t.$strings[r]:""})));let l=!1;"regve"===r&&(l="regve"),e=e.split("|");let i=void 0;for(let a=0;a<e.length;a++)if(e[a].includes("&")){let r=e[a].split("&"),s=!1;for(let e=0;e<r.length&&(s=!!W(r[e],t,l,n),s);e++);if(s){i=!0;break}}else if(i=W(e[a],t,l,n),i){i=W(e[a],t,r,n,s);break}return r?(["string","number","boolean"].includes(typeof i)||(i=""),i.toString()):i}function W(e,t,r=!1,n=!1,s=!1){if(!e||!["string","number","boolean"].includes(typeof e))return;(e=e.toString().trim()).endsWith(";")&&(e=e.substring(0,e.length-1));let i=!1;if("regve"===r&&(i=!0),!i&&n&&"string"==typeof e&&e.match(/([\w_\-$]+)\((.*?)\)/)){const r={...f};r.result=function(e){c+=e},r.setResult=function(e){return["string","number","boolean"].includes(typeof e)?e.toString():""},e=e.split(/([\w_\-$]+\(.*?\))/);for(let n=0;n<e.length;n++)if(e[n].match(/^([\w_\-$]+)\((.*?)\)$/)){let l=S(e[n],t,!1,r);l.result&&s&&s(l.result),l.return&&(e[n]=l.return)}e=e.join("")}let a=!1;if(e.startsWith("{")&&!e.endsWith("}")&&(e+="}",a=!0),e.startsWith("{")&&e.endsWith("}")||e.startsWith("[")&&e.endsWith("]"))try{let t=JSON.parse(E(e));return r&&(t=JSON.stringify(t),a&&(t=t.replace(/}$/,""))),t}catch(e){}a&&(e=e.replace(/}$/,""));const o={};e=(e=e.replace(/\\'/gs,"&#39;").replace(/\\"/gs,"&#34;").replace(/(['"])(.*?)\1/gs,(function(e,t,r){let n=h(16)+h(16);return o[n]=r.replace(/&#39;/gs,"'").replace(/&#34;/gs,'"'),t+"<&%"+n+"%&>"+t})).replace(/&#39;/gs,"\\'").replace(/&#34;/gs,'\\"')).split(/((?:[0-9+\-*/^().e!]|pi|sin|cos|tan|asin|acos|atan|root|pow)+)/gs);for(let t=0;t<e.length;t++)e[t]&&""!==e[t].trim()&&!e[t].match(/^[\w0-9.]+$/s)&&e[t].match(/^([0-9+\-*/^().e!]|pi|sin|cos|tan|asin|acos|atan|root|pow)+$/s)&&(e[t]=e[t].split(/^([+\-*/.]*)(.*?)([+\-*/.]*)$/s),e[t][2]&&(e[t][2]=v(e[t][2])),e[t]=e[t].join(""));(e=e.join("").split(/([+\-*\/]|\.(?=[^\w_0-9])|[^\w_0-9]\.(?=[0-9]))/g)).length>1&&(r=!0);let c="",p=".";function u(e){if(r){if("undefined"!=typeof e)if("."===p||"+"===p)c+=e.toString();else if("-"===p)c=c.replace(e.toString(),"");else if("*"!==p||"number"!=typeof e&&!e.toString().match(/^[0-9]+(\.[0-9]+|)$/)){if("*"===p)c+=e.toString();else if("/"===p){let t=new RegExp(q(e.toString()),"g");l(t)&&(c=c.replace(t,""))}}else c=c.repeat(Number(e))}else c=e}for(let t=0;t<e.length;t++)e[t].match(/^(['"])\s*?\.\s*?\1?.?$/)&&(e[t]="."),[".","+","-","*","/"].includes(e[t].trim())?p=e[t].trim():e[t].trim().match(/^[0-9]+(\.[0-9]+|)$/s)?u(e[t].trim()):(e[t].trim().match(/^(['"])<&%(.*)%&>(\1|)$/)&&(e[t]=e[t].trim().replace(/^(['"])<&%(.*)%&>(\1|)$/,(function(e,t,r){return o[r]?t+o[r]+t:t+t}))),e[t].match(/^(['"]).*\1.?$/)?u(e[t].trim().replace(/^(['"])(.*)\1.?$/,"$2")):e[t].match(/^(['"]).*.?$/)?(e[t+1]&&e[t+1].match(/^(['"])\s*?\.\s*?.?$/)&&(e[t+1].startsWith("'")?e[t]+="'":e[t+1].startsWith('"')&&(e[t]+='"')),u(e[t].trim().replace(/^(['"])(.*)\1.?$/,"$2"))):u(g(e[t].trim())));function g(e){e=e.split("|");let t=void 0;for(let r=0;r<e.length&&(t=m(e[r]),!t);r++);return i&&void 0===t&&(t=""),t}function m(e){let n;return"true"===e||"false"!==e&&(i&&e.startsWith("$")?n=H(e.replace("$",""),t.$):i?n=H(e,t.opts):e.startsWith("$Opts.")||e.startsWith("$Options.")||e.startsWith("$_OPTIONS.")||e.startsWith("$_OPTS.")?n=H(e.replace(/^\$_?opt(?:ion)?s(\.|\[(.*?|)\])/i,$),t.opts):e.startsWith("$Post.")||e.startsWith("$_POST.")?n=H("req.body."+e.replace(/^\$_?post(\.|\[(.*?|)\])/i,$),t):e.startsWith("$Get.")||e.startsWith("$_GET.")?n=H("req.query."+e.replace(/^\$_?get(\.|\[(.*?|)\])/i,$),t):e.startsWith("$Data.")||e.startsWith("$_DATA.")?n=H("req.data."+e.replace(/^\$_?data(\.|\[(.*?|)\])/i,$),t):e.startsWith("$")?(n=H(e.replace("$",""),t.$temp),n||(n=H(e.replace("$",""),t.$))):n=H(e,t.$),r&&(n=!n&&0!==n||!["string","number","boolean"].includes(typeof n)?void 0:n.toString()),n)}function $(e,t){return t?t.replace(/\s/g,"").replace(/^\.*/,""):""}return r?(["string","number","boolean"].includes(typeof c)||(c=""),c.toString()):("string"==typeof c&&c.match(/^-?[0-9]+(\.[0-9]+|)$/)?c=Number(c):"true"===c?c=!0:"false"===c?c=!1:"null"===c?c=null:"undefined"===c&&(c=void 0),c)}function v(e){e=e.toString();try{e=i.eval(e)}catch(t){e="NaN"}return e}function w(e,t){if(!e&&0!==e&&!1!==e)return null;e=e.toString();let r={};return"object"==typeof o.noHtmlRules&&"object"==typeof t.noHtmlRules?r={...o.noHtmlRules,...t}:"object"==typeof o.noHtmlRules?r={...o.noHtmlRules}:"object"==typeof t.noHtmlRules&&(r={...t.noHtmlRules}),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/(?:\*|&ast;){3}([^*]+)(?:\*|&ast;){3}/g,"<strong><em>$1</em></strong>")).replace(/(?:\*|&ast;){2}([^*]+)(?:\*|&ast;){2}/g,"<strong>$1</strong>")).replace(/(?:\*|&ast;)([^*]+)(?:\*|&ast;)/g,"<em>$1</em>")).replace(/__([^_]+)__/g,"<u>$1</u>")).replace(/~~([^~]+)~~/gs,"<s>$1</s>")).replace(/(?:#){6}\s*(.+)/g,"<h6>$1</h6>")).replace(/(?:#){5}\s*(.+)/g,"<h5>$1</h5>")).replace(/(?:#){4}\s*(.+)/g,"<h4>$1</h4>")).replace(/(?:#){3}\s*(.+)/g,"<h3>$1</h3>")).replace(/(?:#){2}\s*(.+)/g,"<h2>$1</h2>")).replace(/(?:#)\s*(.+)/g,"<h1>$1</h1>"),r.allowHeaders&&(e=(e=(e=(e=(e=(e=e.replace(/(?:&num;){6}\s*(.+)/g,"<h6>$1</h6>")).replace(/(?:&num;){5}\s*(.+)/g,"<h5>$1</h5>")).replace(/(?:&num;){4}\s*(.+)/g,"<h4>$1</h4>")).replace(/(?:&num;){3}\s*(.+)/g,"<h3>$1</h3>")).replace(/(?:&num;){2}\s*(.+)/g,"<h2>$1</h2>")).replace(/(?:&num;)\s*(.+)/g,"<h1>$1</h1>")),e=(e=(e=(e=(e=(e=e.replace(/[\n\r]-{3,}[\n\r]/g,"<hr>")).replace(/(?:`|&grave;){3}(.+?)(?:`|&grave;){3}/gs,"<pre>$1</pre>")).replace(/(?:`|&grave;)(.+?)(?:`|&grave;)/gs,"<p>$1</p>")).replace(/([^"'])((?!["'])https?:\/\/(?:(?:[\w_-][\w_\-.]+)|)(?:(?:[\w.,@?^=%&:/~+#_-]*[\w.,@?^=%&:/~+#_-])|))/g,'$1<a href="$2">$2</a>')).replace(/\!\[(.*?)\]\((.*?)\)/g,'<img src="$2" alt="$1">')).replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2">$1</a>'),r.allowImages&&(e=e.replace(/\!&lbrack;(.*?)&rbrack;&lpar;(.*?)&rpar;/g,'<img src="$2" alt="$1">')),r.allowCustomLinks&&(e=e.replace(/&lbrack;(.*?)&rbrack;&lpar;(.*?)&rpar;/g,'<a href="$2">$1</a>')),(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\[ss\]/g,"§")).replace(/\[$c\]/g,"¢")).replace(/\[$e\]/g,"€")).replace(/\[$p\]/g,"£")).replace(/\[c\]/g,"©")).replace(/\[r\]/g,"®")).replace(/\[tm\]/g,"™")).replace(/\[p\]/g,"¶")).replace(/\[Dc\]/g,"℃")).replace(/\[Df\]/g,"℉")).replace(/\[D\]/g,"°")).replace(/\[M\+\]/g,"+")).replace(/\[M-\]/g,"−")).replace(/\[Mx\]/g,"×")).replace(/\[M\/\]/g,"÷")).replace(/\[M=\]/g,"=")).replace(/\[M\!=\]/g,"≠")).replace(/\[M\+-\]/g,"±")).replace(/\[M<\]/g,"<")).replace(/\[M>\]/g,">")).replace(/\[M<=\]/g,"⋜")).replace(/\[M>=\]/g,"⋝")).replace(/\[M%\]/g,"%")).replace(/\[M%0\]/g,"‰")).replace(/\[M%00\]/g,"‱")).replace(/\[Msum\]/g,"∑")).replace(/\[M(sqrt|2root|root)\]/g,"√")).replace(/\[M(cbrt|3root)\]/g,"∛")).replace(/\[M4root\]/g,"∜")).replace(/\[M00\]/g,"∞")).replace(/\[MA(r|90)\]/g,"∟")).replace(/\[MA(a|45|)\]/g,"∠")).replace(/\[M=\?\]/g,"≈")}function k(e){if(!e&&0!==e&&!1!==e)return null;if(e=O(e+="?>"),!u||u.length<1)return e.toString();const t=u.join("|");let r=[],n=new RegExp("(</?(?![^A-Za-z0-9_-]|!DOCTYPE|"+t+")(?:(?:\\s+?[^>]*?)|)>)","gsi");if(!l(n))return e.toString();for(e=e.split(n).map(e=>{if(e.match(n)){let t=e.replace(/<\/?([A-Za-z0-9_-]+).*?>/gis,"$1");if(e.startsWith("</")){if(r.length<=0)return"";if(r[r.length-1]===t)return r.pop(),"</"+t+">";{let e="";for(;r.length>0&&r[r.length-1]!==t;)e+="</"+r[r.length-1]+">",r.pop();return e}}r.push(t)}return e});r.length>0;)e.push("</"+r[r.length-1]+">"),r.pop();return(e=e.join("")).toString()}function x(e){return e&&"string"==typeof e&&""!==e.trim()?(u.includes(e)||u.push(e),!0):null}function O(e){return e||0===e||!1===e?e.toString().replace(/<\/?([A-Za-z0-9_-]+)([^>]+)(<|.$)/gis,"&lt;$1$2$3"):null}function R(e){return e||0===e||!1===e?e.toString().replace(/<\/?([A-Za-z0-9_-]+)([^>]+)(<|.$)/gis,"$2$3"):null}function T(e){return e||0===e||!1===e?e.toString().replace(/&(?!(amp|gt|lt|lbrace|rbrace|sol|bsol|quest|equals|lbrack|rbrack|lpar|rpar|vert|num|sect|ast|comma|period|grave|apos|quot);)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/{/g,"&lbrace;").replace(/}/g,"&rbrace;").replace(/\//g,"&sol;").replace(/\\/g,"&bsol;").replace(/\?/g,"&quest;").replace(/=/g,"&equals;").replace(/\[/g,"&lbrack;").replace(/\]/g,"&rbrack;").replace(/\(/g,"&lpar;").replace(/\)/g,"&rpar;").replace(/\|/g,"&vert;").replace(/#/g,"&num;").replace(/§/g,"&sect;").replace(/\*/g,"&ast;").replace(/,/g,"&comma;").replace(/\./g,"&period;").replace(/`/g,"&grave;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"):null}function M(e){return e||0===e||!1===e?e.toString().replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&lbrace;/g,"{").replace(/&rbrace;/g,"}").replace(/&sol;/g,"/").replace(/&bsol;/g,"\\").replace(/&quest;/g,"?").replace(/&equals;/g,"=").replace(/&lbrack;/g,"[").replace(/&rbrack;/g,"]").replace(/&lpar;/g,"(").replace(/&rpar;/g,")").replace(/&vert;/g,"|").replace(/&num;/g,"#").replace(/&sect;/g,"§").replace(/&ast;/g,"*").replace(/&comma;/g,",").replace(/&period;/g,".").replace(/&grave;/g,"`").replace(/&apos;/g,"'").replace(/&quot;/g,'"'):null}function q(e){return e.replace(/([.*+?^${}()|[\]\\])/g,"\\$1")}function E(e){return e.replace(/[\s\n\r\t]/gs,"").replace(/,([}\]])/gs,"$1").replace(/([,{\[]|)(?:("|'|)([\w_\- ]+)\2:|)("|'|)(.*?)\4([,}\]])/gs,(e,t,r,n,s,l,i)=>(l=l.replace(/"/gis,"").trim(),n&&(n='"'+n.replace(/"/gis,"").trim()+'"'),l.match(/^[0-9]+(\.[0-9]+|)$/)||["true","false"].includes(l)||(l='"'+l+'"'),n?t+n+":"+l+i:t+l+i))}function B(e,t){if(e&&["string","number"].includes(typeof e)&&(e=[e]),e&&"object"==typeof e){let r=Object.keys(e);for(let n=0;n<r.length;n++)t(e[r[n]],r[n],e)}else if(e&&Array.isArray(e))for(let r=0;r<e.length;r++)t(e[r],r,e)}function H(e,t){return!t||!e||"object"!=typeof t&&!Array.isArray(t)||"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e?null:(e=e.split(/(?:\.|\[([^\]]+)\])/gs).filter(e=>e&&""!==e.trim())).reduce((function(e,t){if(t&&"object"==typeof e&&"undefined"!=typeof e[t])return e[t]}),t)}e(m),module.exports=function(){let e=function(e){return"object"==typeof e&&(Object.assign(o,e),(e.cacheDev||!1===e.cacheDev)&&s.cacheDevelopment(e.cacheDev)),b};return e.render=d,e.addFunction=m,e.defineSingleTagType=x,e.escapeHtml=T,e.unescapeHtml=M,e.escapeInvalidTags=O,e.stripInvalidTags=R,e.escapeRegex=q,e.normalizeJson=E,e}();